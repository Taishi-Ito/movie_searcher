package nlp_test

import (
    "testing"
    "movie_searcher/models/nlp"
	"sync"
)

func TestFetchSentenceVector(t *testing.T) {
    sentence := "これはテストです。"
    expectedVec := []float64{-1.2306820154190063, 1.3752975463867188, -0.534199059009552, 0.35476431250572205, -0.7060429453849792, 0.06446763128042221, 0.4830572307109833, -1.0819423198699951, -0.6135009527206421, 0.7719293832778931, -0.7660220265388489, -0.9737778902053833, 0.6340631246566772, 0.6350084543228149, -0.2224217802286148, -0.545103132724762, 0.3717239797115326, -0.4049028754234314, -0.2745051980018616, 0.7151166796684265, 0.7350191473960876, -0.38849130272865295, 0.596930980682373, 0.046796612441539764, -0.396973580121994, -1.2935150861740112, -0.19249987602233887, -0.8359906077384949, 1.2221921682357788, 0.5771859288215637, -0.07028583437204361, -0.5169324278831482, 0.37408825755119324, -0.49161621928215027, -1.6347644329071045, -0.018286122009158134, 0.21077300608158112, -1.1035267114639282, 0.0072676921263337135, -0.2110462635755539, -1.5832334756851196, -0.16013672947883606, -0.3304850161075592, 0.23515701293945312, -0.06801973283290863, 1.3796513080596924, -0.8832536339759827, 1.8824163675308228, -0.3647586405277252, -0.6968315839767456, 0.703223705291748, -0.6011144518852234, 0.6355137228965759, 0.1877952665090561, -1.3308287858963013, -1.826200246810913, 0.9648640751838684, 0.5116327404975891, 0.8614977598190308, -0.38161078095436096, 1.2198482751846313, -0.6667243838310242, 1.8565690517425537, 0.5259125828742981, -0.31258827447891235, 1.4286041259765625, 0.7517600059509277, 0.9590129852294922, -0.4517461359500885, -1.9721128940582275, 0.9628454446792603, 0.46360230445861816, -0.6199520230293274, -0.33975666761398315, 0.13322104513645172, 0.21642020344734192, 1.0812627077102661, 0.5945954918861389, -0.2588193714618683, 0.8079045414924622, -0.12945938110351562, 0.6474772691726685, 0.23360741138458252, 1.1068928241729736, 1.1474435329437256, -0.5182593464851379, 0.3586275279521942, 0.3795066475868225, -0.14531314373016357, -0.5167224407196045, 0.4090592563152313, 0.0026587757747620344, 1.8941404819488525, -0.5752310752868652, 0.7488952279090881, -1.0563539266586304, -0.6328266859054565, -0.11724059283733368, 0.5609341859817505, 1.0236467123031616, 0.1398530751466751, 0.0007789986557327211, -1.3613530397415161, -0.5511965155601501, -0.5628937482833862, -0.07736945152282715, 0.8646416664123535, 0.6651819348335266, 0.03966092690825462, 1.0200639963150024, 0.7108858823776245, 0.7112254500389099, 0.07350562512874603, 1.061842918395996, -1.4981880187988281, -0.9485449194908142, 0.05396858975291252, -0.19613614678382874, -0.6238493919372559, 1.051803708076477, -0.7179988622665405, -0.16538400948047638, -0.298017680644989, 0.434917688369751, -0.9222730994224548, -1.148640513420105, -0.06651467084884644, -0.04187975078821182, -0.7515035271644592, 0.9964474439620972, 0.26914075016975403, -0.44408655166625977, 0.3821766674518585, -1.511651635169983, -0.0760805532336235, 0.17614953219890594, 0.03309980034828186, 1.4199506044387817, 0.8828262090682983, 0.001853219117037952, 0.5754538774490356, 0.46744513511657715, 0.29120853543281555, 1.128872036933899, 0.06889574974775314, -0.11706008017063141, -0.13900645077228546, 0.8882748484611511, 0.7652416229248047, 0.1699674278497696, -1.169677734375, -0.8348356485366821, 0.8045087456703186, -0.4774167537689209, -1.2834080457687378, -0.850531280040741, -0.8555816411972046, -0.9111184477806091, -0.16718651354312897, 0.27154576778411865, -0.17109157145023346, -0.13564468920230865, 0.15970157086849213, 1.5962952375411987, 0.20084010064601898, 1.4211822748184204, 0.28522172570228577, -0.16325941681861877, 0.07989082485437393, 0.2291230857372284, -2.0223910808563232, -0.7316321134567261, -1.097203254699707, -0.8572985529899597, 0.3201868534088135, 0.46312135457992554, -0.483490914106369, 0.08647556602954865, 0.6254124045372009, 0.3234056532382965, 1.3182657957077026, 0.8388622999191284, 0.6166105270385742, -1.0981690883636475, -0.4326117932796478, 0.9111455082893372, -0.24570219218730927, -0.21280328929424286, -0.8636041283607483, 1.1368076801300049, -1.108638048171997, 0.9683827757835388, -0.2540056109428406, 0.45325082540512085, -0.3402255177497864, -0.9097015261650085, -0.9012609720230103, -0.8317216038703918, 0.8748984932899475, -0.1114249974489212, -0.024995071813464165, 0.22154076397418976, 1.8025768995285034, 0.8722315430641174, -1.0153517723083496, 1.2388417720794678, -0.11663903295993805, 0.5910692811012268, 0.8229197263717651, -0.09390651434659958, 1.0567009449005127, 0.5071198344230652, -0.7442880868911743, -1.003502607345581, 0.2881934344768524, -0.45747286081314087, -0.08752384036779404, -0.07761402428150177, -0.45507362484931946, 0.6084223985671997, -1.0398483276367188, -0.674697995185852, -0.4208155572414398, 0.887150228023529, -0.5011215209960938, 0.30304956436157227, -0.16306206583976746, -0.06762858480215073, -0.21420514583587646, 0.688898503780365, -1.1725682020187378, -0.8616533875465393, 0.746353805065155, -0.48870351910591125, -0.0805182009935379, -0.16297435760498047, 0.5685218572616577, 0.5510042309761047, -0.29423099756240845, 0.5803671479225159, 0.5866830945014954, -0.5864537954330444, -0.36686238646507263, -0.1816944032907486, -0.32520169019699097, -0.1886012703180313, -0.6152486801147461, -0.12439509481191635, 0.8813419938087463, 0.44812849164009094, 1.4331762790679932, 0.979924201965332, -0.2833685874938965, 0.4428202509880066, -0.30251947045326233, -0.24047382175922394, -0.05599536374211311, -0.36138710379600525, -0.6492640376091003, 0.05285051837563515, -1.1134454011917114, 1.7906749248504639, 0.11687164753675461, -1.7306205034255981, 0.6740866303443909, -0.5881253480911255, -0.8986955285072327, -0.7440699338912964, -0.25845497846603394, -0.15272364020347595, 2.272845983505249, 0.15195433795452118, 0.05926194414496422, 0.1073700338602066, 0.6484717726707458, -0.6040521860122681, -0.979157567024231, -1.5254472494125366, -0.297009140253067, -0.8021588325500488, -0.5550395250320435, -1.4093573093414307, 0.07562942057847977, 0.06112399324774742, -0.14434489607810974, 0.6340579986572266, 0.362529993057251, -0.2555791735649109, 0.6073302626609802, -0.33381345868110657, 0.20470359921455383, -0.8496729731559753, 0.13342800736427307, 1.5431156158447266, 0.37462764978408813, -0.1788540631532669, -0.5644141435623169, 0.5138164162635803, -0.23426277935504913, -0.8060293793678284, 0.1392739862203598, -2.1515212059020996, 0.15298958122730255, 0.3421482741832733, -0.1577499657869339, -0.8508976697921753, 0.6647288203239441, -0.1413213610649109, -0.4592353403568268, 0.29655641317367554, -0.7422786355018616, -0.3113601505756378, -1.0410913228988647, -0.20624002814292908, 0.7130179405212402, -0.8460859656333923, 0.2898728847503662, 0.8088051676750183, -0.20590826869010925, -0.4084087312221527, 0.11290132254362106, -0.5990959405899048, -0.5128414630889893, -0.424225777387619, -0.4616451561450958, -0.7098093628883362, 0.8078532814979553, 1.3612674474716187, 1.215313196182251, 0.7810675501823425, 0.2151268571615219, 0.2227359116077423, -0.456331729888916, 0.5399178266525269, -0.5903350114822388, 1.339107871055603, -1.2186068296432495, 0.15232937037944794, 1.054129719734192, -0.3828953206539154, 0.4051224887371063, -0.7897249460220337, 1.09712815284729, 0.7053717970848083, -0.8711065053939819, 0.06852640956640244, -0.17200540006160736, -1.077892541885376, 0.30431637167930603, -0.6796869039535522, 0.3735070824623108, 0.6351742148399353, 0.5887892842292786, 0.39182373881340027, -1.005380392074585, 0.8296056389808655, -0.3677760660648346, 0.7014047503471375, 0.3017306327819824, -0.8972703218460083, 0.5330797433853149, -0.48484665155410767, 1.180355191230774, 0.9884108304977417, 0.09734810888767242, 0.7700988054275513, -0.41206520795822144, -0.26934701204299927, -0.248516246676445, -0.22257138788700104, 0.9582729935646057, -0.35199275612831116, 0.331339031457901, -1.4528967142105103, -0.018280893564224243, 0.7274251580238342, -1.0079350471496582, 0.6419467926025391, -0.5126035213470459, -0.21226660907268524, -0.6304150819778442, 0.19785134494304657, 0.5865273475646973, -0.4649038314819336, 0.2802789807319641, -0.2949492037296295, -0.06894196569919586, 0.24565768241882324, -1.9057519435882568, 0.994403064250946, 1.210426926612854, 0.8180221319198608, -0.14905419945716858, -0.17394007742404938, -0.5738235712051392, -0.7423929572105408, 0.8143154978752136, -0.5068415999412537, 0.1883361041545868, -1.2668439149856567, 0.5707013010978699, 0.5649052858352661, 0.41175851225852966, 0.8794088363647461, 0.156944140791893, 0.9484609961509705, -0.27253177762031555, -0.19755931198596954, 0.2376701682806015, 0.31122785806655884, -0.35751643776893616, -0.1811445951461792, -0.3675849735736847, -1.4709585905075073, 0.5885218381881714, -0.5324668288230896, -0.09249658137559891, -0.6505030393600464, -1.7803428173065186, 0.4143372178077698, 0.3526464104652405, -0.3798992335796356, -0.24884869158267975, -1.046481728553772, -0.6537421345710754, 0.10512769222259521, 0.5670798420906067, 0.37271326780319214, -0.7823614478111267, -0.5828951001167297, -0.4463264048099518, 0.34098562598228455, 0.057017482817173004, 0.30399417877197266, 0.4935263991355896, 0.615165650844574, 0.4476424753665924, 0.5122158527374268, -1.5657322406768799, -0.8806936144828796, -0.09965971857309341, 0.6415458917617798, -0.21842701733112335, -0.6189139485359192, 1.0498247146606445, -0.6188880801200867, 0.5616611242294312, -1.2953242063522339, -0.8655341863632202, 0.9382575154304504, -0.8241838812828064, 0.5782674551010132, 0.26483914256095886, -0.5678536295890808, -0.3695499300956726, -0.5253415703773499, -0.3735228180885315, -0.06673289090394974, 1.4498356580734253, -0.95582115650177, 1.1094011068344116, 0.28222793340682983, 0.33696064352989197, 1.1782636642456055, 0.913959801197052, -0.2180810272693634, 1.3252742290496826, -1.1339802742004395, 1.0310909748077393, 0.07876918464899063, 0.5919064879417419, 0.9981304407119751, 0.6629904508590698, 0.7712684869766235, 0.18829843401908875, 0.13894705474376678, 0.46381598711013794, -0.5246232748031616, -0.8513110280036926, 0.2034982442855835, -1.2289460897445679, 0.06266293674707413, 0.786986768245697, -0.9174718260765076, 0.5576174259185791, 1.4521135091781616, -0.05725711211562157, 1.390473484992981, -0.18879911303520203, -0.13116146624088287, 0.9738612174987793, 0.9206879734992981, -0.6408335566520691, -0.24590907990932465, 1.4144502878189087, -1.385766863822937, -0.19063858687877655, -0.4912591278553009, -1.4066983461380005, 0.25620561838150024, -0.42582088708877563, -1.4709616899490356, -0.507904589176178, 1.6063573360443115, -0.02200561761856079, -1.1716949939727783, 0.13416853547096252, -0.47290533781051636, 1.614986538887024, 0.1412661224603653, -0.3374282717704773, 0.4231860339641571, -0.007867357693612576, -0.8201877474784851, 0.36556243896484375, 0.1994020640850067, 0.536969780921936, -0.4398078918457031, -2.1325838565826416, -0.22245952486991882, -0.4245202839374542, -0.22725579142570496, 0.31166043877601624, -0.6394925713539124, -0.04772043600678444, -0.4201827049255371, -0.6528415679931641, 0.5191260576248169, -0.2902108132839203, -0.2386707365512848, 0.15424492955207825, 0.19032631814479828, 0.7223934531211853, 1.6123082637786865, -0.17748339474201202, -0.6540061831474304, -1.08804452419281, 0.5474262833595276, 0.030303511768579483, 1.1130207777023315, -0.3952862620353699, 0.7814649343490601, -0.6250222325325012, 0.9270560145378113, -0.07921772450208664, -0.16648532450199127, 0.121309295296669, -0.16193076968193054, 0.139765202999115, 0.24946308135986328, 0.0014335130108520389, -1.5901044607162476, -0.5963838696479797, -0.2788800597190857, 2.009488582611084, 0.5597370862960815, -0.32124122977256775, 0.2434699684381485, 0.4211947023868561, -1.9781568050384521, 0.22648361325263977, -0.18144722282886505, 0.5809205174446106, -0.05265986919403076, 0.6944534182548523, -0.09331529587507248, 0.16922533512115479, 0.43741217255592346, 0.34388917684555054, -1.4751771688461304, -0.08449745923280716, -0.39860787987709045, 1.0915032625198364, -0.1750795543193817, 0.3422910273075104, 0.2567249834537506, -0.09897210448980331, 1.1711629629135132, -0.1877850741147995, 0.10927461087703705, 1.0296046733856201, -0.5860257744789124, -0.7712607979774475, -0.3868471682071686, 0.28407829999923706, 0.8020135760307312, 0.01688518561422825, 1.4775270223617554, 1.2953605651855469, -0.020924320444464684, -0.7571962475776672, -0.6420368552207947, -0.19971655309200287, 0.330111026763916, -0.45725056529045105, -0.29843297600746155, 0.3851311206817627, 1.2896993160247803, 1.5084882974624634, 0.303239107131958, -2.1698126792907715, -1.1045585870742798, -0.08790431916713715, 0.6755996942520142, 1.1736072301864624, 1.0866914987564087, 0.796862781047821, 0.11578338593244553, 0.5887344479560852, 0.0633096918463707, -0.25975745916366577, -0.25684744119644165, -1.2002910375595093, -1.261020302772522, -1.3079798221588135, -0.8546231389045715, -0.25731921195983887, 0.3944222033023834, 0.7877880930900574, 0.4430045485496521, 0.24568213522434235, 0.32914215326309204, 1.0809186697006226, -0.6773344874382019, 0.26354655623435974, -1.352731466293335, -0.014995204284787178, 0.6189877390861511, -0.02191769704222679, 1.4735300540924072, 1.2827047109603882, 0.49419352412223816, 1.827771782875061, 0.14748896658420563, -0.09863639622926712, -0.018369853496551514, 0.0008887648582458496, -1.3660471439361572, 0.7475361824035645, -0.9773877859115601, -1.5596190690994263, 1.8818591833114624, 0.40388086438179016, -1.4378986358642578, 0.6713597178459167, -1.2022664546966553, 0.05486074090003967, 0.6807471513748169, 0.23326745629310608, -0.13477090001106262, -0.48313555121421814, -0.5140311121940613, 1.104091763496399, -0.16427341103553772, -0.055945105850696564, -0.15765264630317688, -0.10883358865976334, 0.3794800937175751, 0.5336958765983582, 0.23125775158405304, 0.3979930281639099, 0.5895695686340332, -0.7196260094642639, -0.17324957251548767, 0.5004308819770813, 0.6203173995018005, -1.1224571466445923, 0.050988804548978806, -0.10038701444864273, -0.2605971395969391, 0.3245358467102051, -0.5326808094978333, 0.8446258902549744, -0.1968247890472412, -0.6000321507453918, 0.0638553574681282, -1.1046971082687378, 0.08686497062444687, 1.3856772184371948, 1.715193510055542, 0.36793282628059387, 0.6516407132148743, 0.06254713237285614, 1.106708288192749, -0.09603570401668549, -0.775397002696991, -0.3626731336116791, -0.6472307443618774, -0.486551433801651, -0.3867042660713196, -0.4258407950401306, 0.514223575592041, 1.0500307083129883, -0.6423355340957642, 0.9645634889602661, -0.5372143983840942, 0.1265615075826645, -0.764829158782959, -0.9341753721237183, -0.31660065054893494, 0.3646412789821625, -0.14941604435443878, -0.19534137845039368, -1.0152868032455444, -0.2647913694381714, 0.5409050583839417, 0.7532996535301208, 0.23839518427848816, -0.05940508097410202, -1.084029197692871, 0.1007881686091423, -0.5286540389060974, 0.9722722172737122, -1.2253071069717407, 0.752585232257843, -0.08734065294265747, -0.09084182232618332, -0.761222779750824, 0.3049900233745575, -1.8137062788009644, 1.2517460584640503, 1.361271858215332, 0.8247732520103455, 0.030482381582260132, 0.0863727405667305, -0.9215952157974243, -0.6131855249404907, -0.9420643448829651, -1.1325522661209106, 0.4263399541378021, 0.8913635015487671, 1.2849864959716797, 1.3914977312088013, -0.4694575369358063, 0.8488588333129883, 1.2091516256332397, 0.5926870703697205, -0.7221812009811401, 0.22245851159095764, -0.38247132301330566, -0.15327681601047516, -0.7140979170799255, -0.9028859734535217, -0.30057042837142944, -0.5064931511878967, -0.3690890967845917, 1.7104641199111938, 0.9960986971855164, 1.4099589586257935, 1.5444753170013428, 0.5041788220405579, -0.030671464279294014, 0.008423696272075176, 1.400308609008789, -0.4136749804019928, -0.7487758994102478, 0.319702684879303, 0.6568540334701538, -0.37058010697364807, -0.2366245836019516, 0.44316133856773376, -0.6384560465812683, 0.06868307292461395, -0.41495588421821594, 0.09561359882354736, 0.4153672158718109, -0.6315601468086243, -1.3083337545394897}

	var wg sync.WaitGroup
	wg.Add(1)
	ch_vec := make(chan []float64)
	go nlp.FetchSentenceVector(sentence, &wg, ch_vec)
	actualVec := <- ch_vec

    if len(expectedVec) != len(actualVec) {
		t.Errorf("Expected slice length to be '%d', but got '%d'", len(expectedVec), len(actualVec))
		return
	}
	for i, v := range expectedVec {
		if v != actualVec[i] {
			t.Errorf("Expected result to be '%f', but got '%f' instead", v, actualVec[i])
			break
		}
	}
	if len(actualVec) != 768 {
		t.Errorf("Expected slice length to be '%d', but got '%d'", 768, len(actualVec))
		return
	}
}
